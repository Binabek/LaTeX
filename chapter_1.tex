\chapter{Itroduction} 

\section{Background}
Charged particle accelerators have been productive experimental tools for fundamental physics experiments, from rutherfords use of natural acceleration of alpha particles for the discovery of the nucleus to the contemperary multinational physics collaborations centered at the Large Hadron Collider. "Maybe add other physics discoveries" In addition to their useful nature as tools, particle accelerators provide an interesting system to study dynamics in a controlled environment. These same dynamical studies then have direct impacts on the construction of new machines for fundamental studies. As the experiments drive increasing energy and power demands on the beams, careful control of losses becomes more important.

To tackle the challenge of controlling energetic subatomic particles we first have to choose our tools. Some of the earliest "accelerator" experiments relied on energetic decay products, leveraging the weak nuclear force. This is quickly limited by the characteristic energies of these decays. Gravity can be considered and easily dismissed as weak and effectively fixed on the earth's surface. Bulk material interactions can be used to affect the path of particles, but they cannot accelerate and tend to cause significant losses. The default choice has been electromagnetic fields, dating back to early cathode ray experiments. These fields are easy to produce and control and can both steer and provide energy to charged particles. Naturally this restricts our ability to work with neutral particle beams, but this can be typically overcome with a charged primary beam to produce a neutral secondary beam as is the case in succesful neutron spallation and neutrino beam facilities.

Scaling the electrostatic fields from our early cathode ray tubes are a straightforward starting point for accelerating particles. A large voltage applied across carefully shaped electrodes can simultaneously accelerate and focus a beam. This was the guiding principle for early Van De Graf machines like the Westinghouse atom smashe and the Cockroft-Walton style proton sources popularly used in the mid 20th century. This approach still finds use in pellotrons and "tandem" accelerators for low energy nuclear experimentation. However, the practical limits of breakdown gradients quickly limit the energy from such devices. Using an oscillating electric field is a practical approach to bypassing this limitation in two ways. First, the gradients of oscillaitng fields may be much higher than static fields. Second, by selectively timing the particles to be accelerated, the particle can gain energy from the gradient at the frequency of the oscillation. There are a few ways this is currently accomplished. The first is simply physically shielding the particles from the negative gradient, as is done in the Alvarez or drift tube linear accelerator (linac). If the velocity of a travelling EM wave is matched to that of the desired accelerated particle the beam can always see a positive gradient and "surf" the wave. This is the approach of a travelling wave linac, typefied by the original SLAC linac. Another approach is to adjust the path legth of the beam between standing wave structures (usually called cavities) and the phase of these cavities to always arrive in a positive gradient. There are two main approaches using this technique. Either a sequence of cavities with proper phase are used sequentially, a resonant cavity linac. Or, the particles are recirculated to a cavity many times, the case with a broad variety of cyclic machines.

So far the problem of imparting energy to the particles has been given precendence, but naturally the particles must also be steered and focused for useful purposes. Here we can consider magnetic fields as well as electric. While not possible to be used for energy gain, magnetic fields are the preferred option for steering and control. While electrostatic fields are used in some low energy applications, the proportional scaling of the force with momentum from a magnetic field pay divedends as beam energy increases and is the dominant approach for accelerator applications. We can consider then the earliest cyclic machine, the cyclotron. This consists of a single resonant electric gap in a static perpendicular magnetic field. By properly scaling the field strength, in the nonrelatavistic approximation, the classical cyclotron frequency means that the particle will continue to cycle at the correct frequency to see a positive gradient and gain energy. As a result, a modest field on the gap seen many times can result in a significant energy gain for the beam. The tradeoff is that now we have a periodic system which must support stable motion in the plane transverse to the direction of acceleration. This is not unique to cyclic machines.

This problem of stability is of course not unique to accelerators and has a long history of study of dynamical systems. Accordingly, we can construct a hamiltonian of the system. To evaluate the inherent stability of the system we will construct the Hamiltonan for a single particle in external confining potentials in two dimensions. Notably this does not include the self fields of the particle, or of the interactions of many particles in a beam. We are specifically interested in a Hamiltonian which describes a relativitic particle in electromagnetic fields. This results in the general Hamiltonian \ref{eq:H_em} where $\Phi$ and $\vec{A}$ are the typical scalar and vector potentials related to the Electric and Magnetic fields by \ref{eq:phi_A}

\begin{equation} \label{eq:H_em}
H_{EM} = E_{\Phi} = c\sqrt{(\vec{P} - q\vec{A}) + m^2 c^2} + q\Phi
\end{equation}

\begin{equation} \label{eq:phi_A}
\begin{split} 
\vec{E} &= -\nabla \Phi - \frac{\partial \vec{A}}{\partial t}\\
\vec{B} &= \nabla \times \vec{A}
\end{split}
\end{equation}

Here the canonical momentum $\vec{P}$ is related to the mechanical momentum by \ref{eq:P_mv}

\begin{equation} \label{eq:P_mv}
	\vec{P} = \gamma m\vec{v} - q \vec{A}
\end{equation}

And this Hamiltonian is then the total energy of the particle including the contribution from the scalar potential, I will call this $E_{\Phi}$ to differentiate it from the total energy in the absence of the scalar potential.

We will aim to find the equations of motion for the linearized condition and. We would like to refine this expression by changing to a more useful coordinate system. When studying the dynamics of a particle accelerator it is useful to investigate the motion of the particles with respect to some reference trajectory rather their absolute coordinates in the lab frame. To start with, we adopt a Frenet-Serret (Fig. \ref{fig:frenetSerret}) coordinate system where the coordinate axes are defined with respect to a tangent vector of an arbitrary curved path. In the case of an accelerator system, the situation is simpler than this. In practice, bending is only in a single plane, typically horizontal in the lab frame along the floor. Additionally, if bending is only generated from the motion of charged particles in a static magnetic field, the bent path will be circles of a characteristic bending radius $\rho$. The result of this transformation only ends up modifying the momentum along the curved trajectory by a factor of $1 + \frac{x}{\rho}$ and gives us the hamiltonian $H_{f.s.}$ in \ref{eq:H_fs}. This coordinate transformation does not affect the value of the Hamiltonian, so it is still equivalent to the total energy of the test particle with the scalar field contribution.

\begin{figure} \label{fig:frenetSerret}
	\centering
	\includegraphics[width=0.5\linewidth]{placeholder.pdf}
	\caption{Illustration of Frenet-Serret style Coordinate System}
\end{figure}

\begin{equation} \label{eq:H_fs}
	H_{f.s.} = E_{\Phi} = c\sqrt{\left(\frac{p_s}{1 + x/\rho} - qA_s\right)^2 + (P_x - qA_x)^2 + (P_y- qA_y)^2+ m^2c^2} + q\Phi
\end{equation}

Since an accelerator is composed of sequential elements along this reference trajectory, it is useful to change the independent variable to the spacial coordinate along the trajectory. Inspecting the action with respect to the s dimension shows defining the new hamiltonain as $H_s(x,p_x,y,p_y,t,-E_{\Phi};s) = -p_s$ only requires rearranging Eq. \ref{eq:H_fs} to arrive at Eq. \ref{eq:H_s}.

\begin{multline} \label{eq:H_s}
	H_s = -\left(1 + \frac{x}{\rho}\right)\sqrt{\left(\frac{E_{\Phi} - q\Phi}{c}\right)^2 - (P_x -q A_x)^2 - (P_y - q A_y)^2 - m^2c^2}\\ - \left(1 + \frac{x}{\rho}\right)qA_s
\end{multline}

There is one more coordinate transformation we would like to make. Currently our longitudinal cannonical coordinate is time, which will increase quickly along the beam line and become cumbersome. We would like to define the position of the beam with respect to some reference particle, which has the ideal quantites we would like in our accelerated beam. Correspondingly we define a particle on our reference trajectory with a momentum $p_o$ (Eq.\ref{eq:p_o}) directed along the reference trajectory.

\begin{equation} \label{eq:p_o}
	p_o = \beta_o \gamma_o m c
\end{equation}

We can then scale the overall Hamiltonian by this reference momentum Eq. \ref{eq:H_p}. The equations of motion are still satisfied with the inclusion of the already substituted variable changes in Eq. \ref{eq:pOverP}.

\begin{multline} \label{eq:H_p}
	H_p = \frac{H_s}{p_o} = - \left(1 + \frac{x}{\rho}\right)\frac{q}{p_o}A_s\\
-\left(1 + \frac{x}{\rho}\right)\sqrt{\left(\frac{\tilde{E}_{\Phi} - \frac{q}{p_o}\Phi}{c}\right)^2 - \left(p_x -\frac{q}{p_o} A_x\right)^2 - \left(p_y - \frac{q}{p_o} A_y\right)^2 - \frac{m^2c^2}{p_o^2}}
\end{multline}


\begin{equation} \label{eq:pOverP}
\begin{split}
	p_x &= \frac{P_x}{p_o}\\
	p_y &= \frac{P_y}{p_o}\\
	\tilde{E_{\Phi}} &= \frac{E_{\Phi}}{p_o}
\end{split}
\end{equation}

The last coordinate transformation we will make is to shift the longitudinal position of the test particle with respect to our reference particle. Using a generating function of the form Eq. \ref{eq:relGen}


\begin{equation} \label{eq:relGen}
	G_2(x,p_x,y,p_y,t,p_t;s) = x p_x  + y p_y + \left(ct - \frac{s}{\beta_o}\right)\left(p_t - \frac{1}{\beta_o}\right)
\end{equation}

The $x,y$ coordinates are not affected by the transformation, but we have the following new longitudinal coordinates in Eq. \ref{eq:statCoords}. Here we follow the direction convention chosen in ImpactX as it will be the native coordinate system for our simulation results later on.

\begin{equation} \label{eq:statCoords}
\begin{split}
	ct &= ct - \frac{s}{\beta_o}\\
	\tilde{p_t} &= \frac{1}{\beta_o} - \frac{\tilde{E_{\Phi}}}{c}\\
	\tilde{H_p} &= H_p - \frac{\tilde{p_t}}{\beta_o} + \frac{1}{\beta_o^2}
\end{split}
\end{equation}

After substitution and removing the constant $\frac{1}{\beta_o^2}$ term we have the Hamiltonian in Eq. \ref{eq:H_A}

\begin{multline} \label{eq:H_A}
	H_A = - \left(1 + \frac{x}{\rho}\right)\frac{q}{p_o}A_s - \frac{\tilde{p_t}}{\beta_o}\\
	-\left(1 + \frac{x}{\rho}\right)\sqrt{\left(\frac{1}{\beta_o} - \tilde{p_t}  - \frac{q}{p_o c}\Phi\right)^2 - \left(p_x -\frac{q}{p_o} A_x\right)^2 - \left(p_y - \frac{q}{p_o} A_y\right)^2 - \frac{m^2c^2}{p_o^2}}
\end{multline}

We then have arrived at the general Hamiltonian for a particle along our reference trajectory with respect to a nominal reference particle in arbitrary electromagnetic fields. 

From here we now need to decide on which fields to apply to our particle for stable accelration. We are interested in representing the basic accelerator components, i.e. transverse magnets and radiofrequency cavities. For this case we can take $\Phi, A_x, A_y = 0$, which yields the Hamiltonian in \ref{eq:H_bet}. Components that do not meet these conditions, like a solenoid, can be treated analagously to the following approach, but are omitted for brevity.

\begin{equation} \label{eq:H_bet}
	H = -\left(1 + \frac{x}{\rho}\right)\sqrt{\left(\frac{1}{\beta_o} - p_t \right)^2 - p_x^2 - p_y^2- \frac{m^2c^2}{p_o^2}} - \frac{p_t}{\beta_o} - \left(1 + \frac{x}{\rho}\right)\frac{q}{p_o}A_s
\end{equation}

With the scalar potential set to zero, we arrive at a common set of canonoical coordinates used for studies of acclerator dynamics (Eq. \ref{eq:coords}). The relevant difference here from our coordinates above is that now the longitudinal momentum $p_t$ is the difference in the relativistic energy (Eq. \ref{eq:relEnergy}) of the test and reference particle. These definitons are now completely consistent with those used in ImpactX. I refer to the longitudinal spacial coordinate as $ct$ to continually remind that the units are in meters.

\begin{equation} \label{eq:coords}
\begin{split}
x &= x\\
p_x &= \frac{P_x}{p_o}\\
y &= y\\
p_y &= \frac{P_y}{p_o}\\
ct &= c(t-t_o)\\
p_t &= \frac{E_o-E}{p_o c}
\end{split}
\end{equation}

\begin{equation} \label{eq:relEnergy}
	E = \gamma m c^2 \Rightarrow E_o = \gamma_o m c^2
\end{equation}

There are two prominent alternative coordinate definitions in use. The first is an alternative longitudinal coordinate parameterization using the difference in momentum instead of energy, usually called $\delta$, which also changes the longitudinal coordinate defintion to spacial offset. The relationship between these coordinates and the coordinates in Eq. \ref{eq:coords} is given in Eq. \ref{eq:delCoord} and expanded upon in Appendix \ref{apx:delToPt}.

\begin{equation} \label{eq:delCoord}
\begin{split}
	\delta &= \frac{p-p_o}{p_o} = \sqrt{p_t^2 -\frac{2}{\beta_o}p_t + 1} -1 \approx -\frac{p_t}{\beta_o}\\
	z &= ct\frac{\sqrt{\beta_o^2 + \beta_o^2 p_t^2 - 2\beta_o p_t}}{\beta_o p_t - 1} \approx  - \beta_o c t
\end{split}
\end{equation}

The other coordinate convention wich deserves mention is the use of $x' = \frac{dx}{ds}$. This is an easy to understand coordinate, but it is in general non-cannonical and so is avoided in our Hamiltonain based approach. This value converges with our definition of $p_x$ in the ultrarelatavistic case.

Recognizing $\frac{m^2c^2}{p_o^2} = \frac{1}{\beta_o^2 \gamma_o^2}$ we can make one more simplification now that $\Phi = 0$, giving us the hamiltonian in Eq. \ref{eq:H_As}.

\begin{equation} \label{eq:H_As}
	H = -\left(1 + \frac{x}{\rho}\right)\sqrt{1 + p_t^2 - \frac{2 p_t}{\beta_o} - p_x^2 - p_y^2- } - \frac{p_t}{\beta_o} - \left(1 + \frac{x}{\rho}\right)\frac{q}{p_o}A_s
\end{equation}

The exact form of $A_s$ must now be selected to find our equations of motion. Before we do so we will consider the general form of this expansion we are interested in.

\section{Multipole Expansion}

\section{Linearized Hamiltonian}
Based on the form of the multipole expansion, we can see that only our dipole and quadrupole elements will affect the dynamics to the first order. While in general, we can use potentials of any order, we are not garanteed an analytical solution. We can, however find solutions to the first order terms.

\cite{danilov_nonlinear_2010}
